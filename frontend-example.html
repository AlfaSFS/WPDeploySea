<!DOCTYPE html>
<html lang="ru">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>CV Services - WayForPay Integration</title>
      <style>
         body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
         }
         .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
         }
         .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            margin: 10px 0;
            border-radius: 5px;
         }
         .service-item.selected {
            background-color: #e3f2fd;
            border-color: #2196f3;
         }
         .checkbox {
            margin-right: 15px;
         }
         .service-info {
            flex-grow: 1;
         }
         .service-name {
            font-weight: bold;
            margin-bottom: 5px;
         }
         .service-description {
            color: #666;
            font-size: 14px;
         }
         .service-price {
            font-weight: bold;
            color: #2196f3;
            font-size: 18px;
         }
         .form-group {
            margin: 20px 0;
         }
         .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
         }
         .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
         }
         .total {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
         }
         .total-amount {
            font-size: 24px;
            font-weight: bold;
            color: #2196f3;
         }
         .btn {
            background-color: #2196f3;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
         }
         .btn:hover {
            background-color: #1976d2;
         }
         .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
         }
         .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
         }
         .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
         }
         .success {
            background-color: #e8f5e8;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
         }
      </style>
   </head>
   <body>
      <div class="container">
         <h1>üö¢ CV Services –¥–ª—è –º–æ—Ä—è–∫–æ–≤</h1>
         <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Å–ª—É–≥–∏ –∏ –æ–ø–ª–∞—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ WayForPay</p>

         <div class="error" id="error"></div>
         <div class="success" id="success"></div>

         <!-- –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ -->
         <div id="services">
            <div
               class="service-item"
               data-name="CV Writing Service"
               data-price="80"
            >
               <input type="checkbox" class="checkbox" id="service1" />
               <div class="service-info">
                  <div class="service-name">–ù–∞–ø–∏—Å–∞–Ω–∏–µ CV</div>
                  <div class="service-description">
                     –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—é–º–µ –¥–ª—è –º–æ—Ä—è–∫–æ–≤
                  </div>
               </div>
               <div class="service-price">80 UAH</div>
            </div>

            <div
               class="service-item"
               data-name="CV Translation"
               data-price="40"
            >
               <input type="checkbox" class="checkbox" id="service2" />
               <div class="service-info">
                  <div class="service-name">–ü–µ—Ä–µ–≤–æ–¥ CV</div>
                  <div class="service-description">
                     –ü–µ—Ä–µ–≤–æ–¥ —Ä–µ–∑—é–º–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
                  </div>
               </div>
               <div class="service-price">40 UAH</div>
            </div>

            <div
               class="service-item"
               data-name="Email Distribution"
               data-price="30"
            >
               <input type="checkbox" class="checkbox" id="service3" />
               <div class="service-info">
                  <div class="service-name">–†–∞—Å—Å—ã–ª–∫–∞ –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º</div>
                  <div class="service-description">
                     –û—Ç–ø—Ä–∞–≤–∫–∞ CV –≤ –º–æ—Ä—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
                  </div>
               </div>
               <div class="service-price">30 UAH</div>
            </div>

            <div class="service-item" data-name="Cover Letter" data-price="25">
               <input type="checkbox" class="checkbox" id="service4" />
               <div class="service-info">
                  <div class="service-name">–°–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ</div>
                  <div class="service-description">
                     –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏
                  </div>
               </div>
               <div class="service-price">25 UAH</div>
            </div>
         </div>

         <!-- –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ -->
         <form id="orderForm">
            <div class="form-group">
               <label for="email">Email *</label>
               <input type="email" id="email" required />
            </div>

            <div class="form-group">
               <label for="firstName">–ò–º—è *</label>
               <input type="text" id="firstName" required />
            </div>

            <div class="form-group">
               <label for="lastName">–§–∞–º–∏–ª–∏—è *</label>
               <input type="text" id="lastName" required />
            </div>

            <div class="form-group">
               <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
               <input
                  type="tel"
                  id="phone"
                  placeholder="+380501234567"
                  required
               />
            </div>

            <!-- –ò—Ç–æ–≥–æ -->
            <div class="total">
               <div>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</div>
               <div class="total-amount" id="totalAmount">0 UAH</div>
            </div>

            <button type="submit" class="btn" id="payButton" disabled>
               üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ WayForPay
            </button>
         </form>

         <div class="loading" id="loading">
            <p>–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞...</p>
         </div>
      </div>

      <script>
         // –î–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥
         const services = [
            { name: "CV Writing Service", price: 80 },
            { name: "CV Translation", price: 40 },
            { name: "Email Distribution", price: 30 },
            { name: "Cover Letter", price: 25 },
         ];

         // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã
         function updateTotal() {
            const checkboxes = document.querySelectorAll(
               '.service-item input[type="checkbox"]:checked'
            );
            let total = 0;
            let selectedItems = [];

            checkboxes.forEach((checkbox) => {
               const serviceItem = checkbox.closest(".service-item");
               const price = parseInt(serviceItem.dataset.price);
               const name = serviceItem.dataset.name;

               total += price;
               selectedItems.push({
                  name: name,
                  price: price,
                  count: 1,
               });
            });

            document.getElementById("totalAmount").textContent = `${total} UAH`;

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã –µ—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
            const payButton = document.getElementById("payButton");
            payButton.disabled = total === 0;

            return { total, selectedItems };
         }

         // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤
         document
            .querySelectorAll('.service-item input[type="checkbox"]')
            .forEach((checkbox) => {
               checkbox.addEventListener("change", function () {
                  const serviceItem = this.closest(".service-item");
                  if (this.checked) {
                     serviceItem.classList.add("selected");
                  } else {
                     serviceItem.classList.remove("selected");
                  }
                  updateTotal();
               });
            });

         // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
         document
            .getElementById("orderForm")
            .addEventListener("submit", async function (e) {
               e.preventDefault();

               const { total, selectedItems } = updateTotal();

               if (total === 0) {
                  showError("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —É—Å–ª—É–≥—É");
                  return;
               }

               const orderData = {
                  email: document.getElementById("email").value,
                  amount: total,
                  currency: "UAH",
                  items: selectedItems,
                  first_name: document.getElementById("firstName").value,
                  last_name: document.getElementById("lastName").value,
                  phone: document.getElementById("phone").value,
               };

               try {
                  showLoading(true);
                  hideError();
                  hideSuccess();

                  const response = await fetch("/api/orders", {
                     method: "POST",
                     headers: {
                        "Content-Type": "application/json",
                     },
                     body: JSON.stringify(orderData),
                  });

                  const result = await response.json();

                  if (response.ok) {
                     showSuccess(`–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω! ID: ${result.id}`);

                     // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ WayForPay
                     if (result.payment_url) {
                        setTimeout(() => {
                           window.location.href = result.payment_url;
                        }, 2000);
                     }
                  } else {
                     showError(
                        `–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: ${
                           result.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"
                        }`
                     );
                  }
               } catch (error) {
                  showError(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
               } finally {
                  showLoading(false);
               }
            });

         // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
         function showError(message) {
            const errorDiv = document.getElementById("error");
            errorDiv.textContent = message;
            errorDiv.style.display = "block";
         }

         function hideError() {
            document.getElementById("error").style.display = "none";
         }

         function showSuccess(message) {
            const successDiv = document.getElementById("success");
            successDiv.textContent = message;
            successDiv.style.display = "block";
         }

         function hideSuccess() {
            document.getElementById("success").style.display = "none";
         }

         function showLoading(show) {
            document.getElementById("loading").style.display = show
               ? "block"
               : "none";
            document.getElementById("payButton").disabled = show;
         }

         // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
         updateTotal();
      </script>
   </body>
</html>
